<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learning the hidden layers - Distributed Training</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .content-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 60px 100px;
            position: relative;
        }

        .page-title {
            font-family: sans-serif;
            font-size: 2.8rem;
            font-weight: normal;
            color: #ffffff;
            margin-bottom: 60px;
            text-align: center;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.6s ease;
            position: relative;
            z-index: 20; /* Higher than step-8's z-index of 10 */
        }

        .page-title.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .content-area {
            width: 100%;
            max-width: 1400px;
            position: relative;
            min-height: 60vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* All content blocks overlay each other */
        .content-step {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: all 0.6s ease;
            z-index: 1;
        }

        .content-step.visible {
            opacity: 1;
            pointer-events: all;
            z-index: 2;
        }

        /* Numbered list step gets full background */
        .content-step#step-8 {
            background: #1a1a1a;
            width: 100vw;
            height: 100vh;
            top: 0;
            left: 0;
            transform: none;
            padding: 70px 100px 120px 100px; /* Reduced top padding to bring list closer to title */
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* Changed from center to flex-start */
            align-items: center;
            overflow: visible; /* Ensure all items are considered in layout */
        }

        .content-step#step-8.visible {
            z-index: 10;
        }

        /* Step 9 (image) should appear above step-8 */
        .content-step#step-9 {
            z-index: 11;
        }

        .content-step#step-9.visible {
            z-index: 11;
        }
        
        /* Reduce title margin when step-8 is visible */
        body.step-8-active .page-title {
            margin-bottom: 20px; /* Reduced from 60px */
        }

        /* Text Block Styles */
        .text-block {
            font-size: 1.5rem;
            line-height: 1.8;
            color: #e0e0e0;
            text-align: center;
            padding: 0;
            width: 100%;
            max-width: 900px;
        }

        /* Numbered Text Item Styles */
        .numbered-item {
            display: flex;
            align-items: flex-start;
            gap: 30px;
            margin-bottom: 30px;
            opacity: 0;
            transform: translateY(40px); /* Start from bottom */
            transition: opacity 0.6s ease, transform 0.6s ease;
            width: 100%;
            max-width: 1100px;
            pointer-events: none; /* Prevent interaction when hidden */
            /* Items with opacity: 0 still take up space in layout */
            visibility: visible; /* Keep in layout flow */
            min-height: auto; /* Ensure height is calculated */
        }

        .numbered-item:last-child {
            margin-bottom: 0;
        }

        .numbered-item.visible {
            opacity: 1;
            transform: translateY(0); /* Slide up to final position */
            pointer-events: auto;
        }

        .item-number {
            font-size: 1.8rem;
            color: #4a9eff;
            font-weight: normal;
            min-width: 60px;
            text-align: right;
        }

        .item-content {
            flex: 1;
            font-size: 1.5rem;
            line-height: 1.8;
            color: #e0e0e0;
            text-align: left;
        }

        .numbered-list {
            width: 100%;
            max-width: 1100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Start from top, let parent center the whole container */
            /* Ensure container always accounts for all 3 items for proper centering */
            /* This ensures the whole list is centered, not just the first visible item */
            flex-shrink: 0; /* Prevent shrinking */
        }
        
        /* Force all numbered items to always reserve their space in layout */
        #step-8 .numbered-item {
            /* Items are always in layout flow, even with opacity: 0 */
            /* This ensures the numbered-list container height accounts for all items */
            visibility: visible; /* Keep items in layout even when opacity is 0 */
            height: auto; /* Ensure height is calculated */
            flex-shrink: 0; /* Prevent items from shrinking */
        }

        /* Image Block Styles */
        .image-block {
            width: 100%;
            max-width: 1000px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .image-block img {
            max-width: 100%;
            max-height: 70vh;
            width: auto;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        /* Side animation for step-9 */
        .image-block.slide-in-from-right {
            opacity: 0;
            transform: translateX(100px);
            transition: opacity 0.8s ease, transform 0.8s ease;
        }

        .content-step#step-9.visible .image-block.slide-in-from-right {
            opacity: 1;
            transform: translateX(0);
        }

        /* Mixed Content Block (text + image) */
        .mixed-block {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 30px;
            align-items: center;
        }

        .mixed-block .text-content {
            font-size: 1.5rem;
            line-height: 1.8;
            color: #e0e0e0;
            text-align: center;
            max-width: 900px;
        }

        .mixed-block .image-content {
            max-width: 1000px;
            width: 100%;
        }

        .mixed-block .image-content img {
            max-width: 100%;
            max-height: 60vh;
            width: auto;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        /* Animation controls - visually hidden but structurally present for parent to detect */
        .animation-controls {
            position: fixed;
            bottom: 70px;
            right: 30px;
            display: flex;
            gap: 15px;
            align-items: center;
            background: rgba(45, 45, 45, 0.95);
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            z-index: 1003;
            backdrop-filter: blur(10px);
            /* Hide from view but keep in DOM for parent detection */
            visibility: hidden;
            pointer-events: none;
        }

        .anim-arrow {
            background: rgba(60, 60, 60, 0.9);
            border: 2px solid #555;
            color: #e0e0e0;
            font-size: 20px;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            user-select: none;
        }

        .anim-arrow:hover {
            background: rgba(80, 80, 80, 0.9);
            border-color: #666;
            transform: scale(1.1);
        }

        .anim-arrow:active {
            transform: scale(0.95);
        }

        .anim-arrow:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
        }

        .animation-step-indicator {
            color: #b0b0b0;
            font-size: 14px;
            margin: 0 10px;
            min-width: 80px;
            text-align: center;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .content-container {
                padding: 40px 30px;
            }

            .page-title {
                font-size: 2rem;
                margin-bottom: 40px;
            }

            .text-block {
                font-size: 1.2rem;
            }

            .mixed-block .text-content {
                font-size: 1.2rem;
            }

            .content-step#step-8 {
                padding: 40px 30px 120px 30px;
            }

            .item-content {
                font-size: 1.2rem;
            }

            .item-number {
                font-size: 1.5rem;
                min-width: 50px;
            }

            .numbered-item {
                gap: 20px;
                margin-bottom: 25px;
            }

            .animation-controls {
                bottom: 70px;
                right: 15px;
                padding: 8px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="content-container">
        <h1 class="page-title" id="title">Learning the hidden layers</h1>
        
        <div class="content-area">
            <!-- Step 1: Introduction text -->
            <div class="content-step" id="step-1">
                <div class="text-block">
                    Backpropagation is the algorithm used to train neural networks
                </div>
            </div>

            <!-- Step 2: First image (004.01) -->
            <div class="content-step" id="step-2">
                <div class="image-block">
                    <img src="images/004.01.random-trash.png" alt="Backpropagation Step 1">
                </div>
            </div>

            <!-- Step 3: Second image (004.02) -->
            <div class="content-step" id="step-3">
                <div class="image-block">
                    <img src="images/004.02.random-trash.png" alt="Backpropagation Step 2">
                </div>
            </div>

            <!-- Step 4: Third image (004.03) -->
            <div class="content-step" id="step-4">
                <div class="image-block">
                    <img src="images/004.03.random-trash.png" alt="Backpropagation Step 3">
                </div>
            </div>

            <!-- Step 5: Explanation text -->
            <div class="content-step" id="step-5">
                <div class="text-block">
                    It calculates gradients by propagating errors backward through the network
                </div>
            </div>

            <!-- Step 6: Fourth image (004.04) -->
            <div class="content-step" id="step-6">
                <div class="image-block">
                    <img src="images/004.04.random-trash.png" alt="Backpropagation Step 4">
                </div>
            </div>

            <!-- Step 7: Mixed content (text + image 004.05) -->
            <div class="content-step" id="step-7">
                <div class="mixed-block">
                    <div class="text-content">
                        The algorithm updates weights to minimize the loss function C(w)
                    </div>
                    <div class="image-content">
                        <img src="images/004.05.random-trash.png" alt="Backpropagation Step 5">
                    </div>
                </div>
            </div>

            <!-- Step 8: Numbered list slide -->
            <div class="content-step" id="step-8">
                <div class="numbered-list">
                    <div class="numbered-item" id="item-01">
                        <div class="item-number">01</div>
                        <div class="item-content">
                            The goal is to minimize the cost C(w) so that the weights and biases gets better and better at predicting the digits correctly
                        </div>
                    </div>
                    <div class="numbered-item" id="item-02">
                        <div class="item-number">02</div>
                        <div class="item-content">
                            The well-known approach is called gradient descent. Compute the derivative of C(w) with respect to w and update the weights with a scaled version of the gradient
                        </div>
                    </div>
                    <div class="numbered-item" id="item-03">
                        <div class="item-number">03</div>
                        <div class="item-content">
                            Since we have deep neural networks with multiple hidden layers, we apply chain-rule in calculus to compute the gradients. Backpropagation
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 9: Image 004.06 with side animation -->
            <div class="content-step" id="step-9">
                <div class="image-block slide-in-from-right">
                    <img src="images/004.06.random-trash.png" alt="Backpropagation Step 6">
                </div>
            </div>
        </div>

        <!-- Animation controls -->
        <div class="animation-controls">
            <button class="anim-arrow" id="prevAnim" onclick="navigateAnimation(-1)">←</button>
            <div class="animation-step-indicator">
                <span id="currentStep">1</span> / <span id="totalSteps">13</span>
            </div>
            <button class="anim-arrow" id="nextAnim" onclick="navigateAnimation(1)">→</button>
        </div>
    </div>

    <script>
        // Animation state management
        let currentAnimationStep = 0;
        const totalAnimationSteps = 13;

        // Animation sequence
        const animations = [
            () => {
                // Step 1: Show title
                document.getElementById('title').classList.add('visible');
            },
            () => {
                // Step 2: Show first text block
                document.getElementById('step-1').classList.add('visible');
            },
            () => {
                // Step 3: Show first image (004.01)
                document.getElementById('step-2').classList.add('visible');
            },
            () => {
                // Step 4: Show second image (004.02)
                document.getElementById('step-3').classList.add('visible');
            },
            () => {
                // Step 5: Show third image (004.03)
                document.getElementById('step-4').classList.add('visible');
            },
            () => {
                // Step 6: Show second text block
                document.getElementById('step-5').classList.add('visible');
            },
            () => {
                // Step 7: Show fourth image (004.04)
                document.getElementById('step-6').classList.add('visible');
            },
            () => {
                // Step 8: Show mixed content (text + image 004.05)
                document.getElementById('step-7').classList.add('visible');
            },
            () => {
                // Step 9: Show numbered list slide
                document.getElementById('step-8').classList.add('visible');
            },
            () => {
                // Step 10: Show first numbered item
                document.getElementById('item-01').classList.add('visible');
            },
            () => {
                // Step 11: Show second numbered item
                document.getElementById('item-02').classList.add('visible');
            },
            () => {
                // Step 12: Show third numbered item
                document.getElementById('item-03').classList.add('visible');
            }
        ];

        // Initialize
        function init() {
            updateAnimation();
            updateControls();
        }

        // Navigate animation (can be called from parent or internally)
        function navigateAnimation(direction) {
            const newStep = currentAnimationStep + direction;
            if (newStep >= 0 && newStep < totalAnimationSteps) {
                currentAnimationStep = newStep;
                updateAnimation();
                updateControls();
            }
        }

        // Expose navigateAnimation globally for parent window access
        window.navigateAnimation = navigateAnimation;

        // Update animation display
        function updateAnimation() {
            // First, hide everything
            document.getElementById('title').classList.remove('visible');
            for (let i = 1; i <= 9; i++) {
                const step = document.getElementById(`step-${i}`);
                if (step) {
                    step.classList.remove('visible');
                }
            }
            for (let i = 1; i <= 3; i++) {
                const item = document.getElementById(`item-0${i}`);
                if (item) {
                    item.classList.remove('visible');
                }
            }

            const step8 = document.getElementById('step-8');
            const step9 = document.getElementById('step-9');

            // Step 12 (index 12): Show step-9 image, hide step-8
            if (currentAnimationStep === 12) {
                // Show title
                document.getElementById('title').classList.add('visible');
                // Hide step-8 (numbered list)
                if (step8) {
                    step8.classList.remove('visible');
                }
                document.body.classList.remove('step-8-active');
                // Show step-9 (image with side animation)
                if (step9) {
                    step9.classList.add('visible');
                }
            }
            // If we're on the numbered list slide (steps 8-11), show only that
            else if (currentAnimationStep >= 8 && currentAnimationStep <= 11) {
                // Show title for numbered list slide
                document.getElementById('title').classList.add('visible');
                if (step8) {
                    step8.classList.add('visible');
                }
                document.body.classList.add('step-8-active'); // Add class to reduce title margin
                
                // Force browser to calculate layout for all items to ensure proper centering
                // This ensures the numbered-list container accounts for all 3 items
                for (let i = 1; i <= 3; i++) {
                    const item = document.getElementById(`item-0${i}`);
                    if (item) {
                        // Force layout calculation by reading offsetHeight
                        void item.offsetHeight;
                    }
                }
                
                // Show numbered items up to current step
                // Step 8: step-8 only, Step 9: step-8 + item-01, Step 10: + item-02, Step 11: + item-03
                if (currentAnimationStep >= 9) {
                    const itemIndex = currentAnimationStep - 9; // 0, 1, or 2
                    for (let i = 1; i <= itemIndex + 1; i++) {
                        const item = document.getElementById(`item-0${i}`);
                        if (item) {
                            item.classList.add('visible');
                        }
                    }
                }
            } else {
                // Remove step-8-active class when not on step-8
                document.body.classList.remove('step-8-active');
                // For steps 1-7, show only the current step (and title)
                // Step 0: title only
                if (currentAnimationStep >= 0) {
                    document.getElementById('title').classList.add('visible');
                }
                
                // Show only the current content step (1-7)
                // Step 1 (index 1) shows step-1, Step 2 (index 2) shows step-2, etc.
                if (currentAnimationStep >= 1 && currentAnimationStep <= 7) {
                    const stepId = `step-${currentAnimationStep}`;
                    const step = document.getElementById(stepId);
                    if (step) {
                        step.classList.add('visible');
                    }
                }
            }
        }

        // Update control buttons
        function updateControls() {
            const prevBtn = document.getElementById('prevAnim');
            const nextBtn = document.getElementById('nextAnim');
            const currentStepSpan = document.getElementById('currentStep');
            const totalStepsSpan = document.getElementById('totalSteps');

            if (prevBtn) prevBtn.disabled = currentAnimationStep === 0;
            if (nextBtn) nextBtn.disabled = currentAnimationStep === totalAnimationSteps - 1;
            if (currentStepSpan) currentStepSpan.textContent = currentAnimationStep + 1;
            if (totalStepsSpan) totalStepsSpan.textContent = totalAnimationSteps;

            // Send animation state to parent window
            if (window.parent) {
                window.parent.postMessage({
                    type: 'animationState',
                    currentStep: currentAnimationStep + 1,
                    totalSteps: totalAnimationSteps,
                    canGoPrev: currentAnimationStep > 0,
                    canGoNext: currentAnimationStep < totalAnimationSteps - 1
                }, '*');
            }
        }

        // Listen for messages from parent window
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'navigateAnimation') {
                navigateAnimation(event.data.direction);
            } else if (event.data && event.data.type === 'requestAnimationState') {
                updateControls();
            }
        });

        // Prevent page navigation when clicking animation controls
        document.querySelectorAll('.anim-arrow').forEach(arrow => {
            arrow.addEventListener('click', (e) => {
                e.stopPropagation();
            });
        });

        // Initialize on load
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

